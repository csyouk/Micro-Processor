#include "device_driver.h"
#define BLOCK 100
#define FILE_SIZE (240*(320*3)*4)
#define LCD_FB0	0x31800000 // 4MB

typedef unsigned int (* LAYER_FRAME)[LCD_XSIZE];
extern LAYER_FRAME Fb_Layer;
extern int Cam_Width;
extern int Cam_Height;
extern int frm;
extern unsigned int Display_frame;

void Save_Img_To_Nand(void){
	int i, j;
	unsigned int q = Nand_Page_2_Addr(BLOCK, 0, 0);
	if(!q){
		Uart_Printf("Saved failed!!\n");
		return;
	}
	Nand_Write(q, Fb_Layer, FILE_SIZE);


	for(i=0,j=0;i<20;i++, j++){
		Uart_Printf("%.8p ",Fb_Layer[i]);
		if(j % 4 == 0){j=0;Uart_Printf("\n");}
	}
}

void Disable_Capture(void){
	CAM_Capture_Run(0,0,0);
	CAM_Capture_Run(0, Cam_Width, Cam_Height);
	CAM_Interrupt_Enable(0);
}

void Enable_Capture(void){
	CAM_Capture_Run(0,0,0);
	CAM_Capture_Run(1, Cam_Width, Cam_Height);
	CAM_Interrupt_Enable(1);
}

void Show_Saved_Img(void){
	int i, j;
	unsigned int q = Nand_Page_2_Addr(BLOCK, 0, 0);
	unsigned int * r = (unsigned int *)q;

	Uart_Printf("\n---------\n");
	for(i=0, j=0;i<20;i++, j++){
		Uart_Printf("%.8p ",r[i]);
		if(j % 4 == 0){j=0;Uart_Printf("\n");}
	}

//	Nand_Read(q, buff, FILE_SIZE);
// 	Lcd_Select_Draw_Frame_Buffer(frm);
//	Lcd_Draw_Cam_Image(0, 0, (void *)buff, Cam_Width, Cam_Height);
//	Lcd_Set_Address(buff);
}


